<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">

		<title>Genuary23 | 22 - Shadows</title>

		<script src="../p5.js"></script>
	</head>
	<style>
		body {
			padding: 0;
			margin: 0;
			position: fixed;
			top: 0; left: 0; right: 0; bottom: 0;
			border: none;
			overflow: hidden;
		}
	</style>
	<body></body>
	<script>
		const MODE_DEBUG = false;
		const BG_COLOR = 7, FG_COLOR_SAT = 70, FG_COLOR_LIG = 60, FG_COLOR_ALPHA = .2;

		function setup() {
			createCanvas( window.innerWidth, window.innerHeight );
			noLoop( );
			setStyle( );
		}

		function setStyle( ) {
			colorMode( HSL );
			angleMode( RADIANS );
			strokeWeight( .5 );
			noFill( );
		}

		function draw( ) {
			background( BG_COLOR );
			translate( width * .5, height * .5 );
			for ( let hue = 0; hue < 360; hue += 60 ) {
				stroke( hue, FG_COLOR_SAT, FG_COLOR_LIG, FG_COLOR_ALPHA );
				drawJellyfish( width * random( .1, .6 ), random( 20, 120 ) );
			}
		}

		function debug( size, hue, callback ) {
			if ( MODE_DEBUG ) {
				strokeWeight( size );
				stroke( hue, 100, 50, .6 );
				callback( );
			}
		}

		function drawJellyfish( dim, scale ) {
			debug( 5, 300, () => { circle( 0, 0, dim ) } );
			const n = 2000; // ha de ser nombre parell
			const da = TAU / n;
			for ( let a = 0; a < PI; a += da )
				drawJellyfishParticle( a, dim * .5, scale );
		}

		function n( x, y, scale ) {
			return noise( x/scale, y/scale ) + 1;
		}

		function drawJellyfishParticle( angle, radius, s ) {
			const x1 = cos( angle ) * radius;
			const y1 = sin( angle ) * radius;
			debug( 18, 60, () => { point( x1, y1 ) } );
			const x2 = cos( angle + PI ) * radius;
			const y2 = sin( angle + PI ) * radius;
			debug( 18, 60, () => { point( x2, y2 ) } );
			debug( 6, 180, () => { line( x1, y1, x2, y2 ) } );
			const x1_ = x1 * n( x1, angle, s );
			const y1_ = y1 * n( y1, angle, s );
			debug( 12, 60, () => { point( x1_, y1_ ) } );
			const x2_ = x2 * n( x2, angle, s );
			const y2_ = y2 * n( y2, angle, s );
			debug( 12, 60, () => { point( x2_, y2_ ) } );
			debug( 3, 180, () => { line( x1, y1, x1_, y1_ ) } );
			debug( 3, 180, () => { line( x2, y2, x2_, y2_ ) } );
			if ( !MODE_DEBUG ) bezier( x1_, y1_, x1, y1, x2, y2, x2_, y2_ );
		}
	</script>
</html>
